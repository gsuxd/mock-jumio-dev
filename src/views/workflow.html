<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jumio Verification - Mock</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 100%;
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .content {
        padding: 40px 30px;
      }

      .step {
        display: none;
      }

      .step.active {
        display: block;
        animation: fadeIn 0.3s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .step-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
      }

      .step-description {
        color: #666;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .upload-area {
        border: 2px dashed #667eea;
        border-radius: 12px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 20px;
      }

      .upload-area:hover {
        border-color: #764ba2;
        background: #f8f9ff;
      }

      .upload-area.uploaded {
        border-color: #10b981;
        background: #f0fdf4;
      }

      .upload-icon {
        font-size: 48px;
        margin-bottom: 10px;
      }

      .upload-text {
        color: #666;
        font-size: 14px;
      }

      .btn {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 30px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
      }

      .success-icon {
        font-size: 80px;
        text-align: center;
        margin-bottom: 20px;
      }

      .error-icon {
        font-size: 80px;
        text-align: center;
        margin-bottom: 20px;
        color: #ef4444;
      }

      .loading {
        text-align: center;
        padding: 40px 0;
      }

      .spinner {
        border: 4px solid #f3f4f6;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .mock-badge {
        background: #fef3c7;
        color: #92400e;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 20px;
      }

      input[type="file"] {
        display: none;
      }

      .camera-preview {
        width: 100%;
        max-width: 300px;
        height: 300px;
        margin: 0 auto 20px;
        border-radius: 50%;
        border: 4px solid #667eea;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f3f4f6;
      }

      .camera-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Identity Verification</h1>
        <p>Secure document verification process</p>
      </div>

      <div class="content">
        <div class="mock-badge">üß™ MOCK SERVER - Testing Mode</div>

        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <!-- Step 1: ID Front -->
        <div class="step active" id="step1">
          <h2 class="step-title">Step 1: Upload ID (Front)</h2>
          <p class="step-description">
            Please upload the front side of your government-issued ID
          </p>

          <div
            class="upload-area"
            id="uploadFront"
            onclick="document.getElementById('fileFront').click()"
          >
            <div class="upload-icon">üìÑ</div>
            <div class="upload-text">Click to upload front of ID</div>
          </div>
          <input
            type="file"
            id="fileFront"
            accept="image/*"
            onchange="handleFileUpload('front')"
          />

          <button
            class="btn btn-primary"
            id="btnStep1"
            onclick="nextStep()"
            disabled
          >
            Continue
          </button>
        </div>

        <!-- Step 2: ID Back -->
        <div class="step" id="step2">
          <h2 class="step-title">Step 2: Upload ID (Back)</h2>
          <p class="step-description">
            Please upload the back side of your government-issued ID
          </p>

          <div
            class="upload-area"
            id="uploadBack"
            onclick="document.getElementById('fileBack').click()"
          >
            <div class="upload-icon">üìÑ</div>
            <div class="upload-text">Click to upload back of ID</div>
          </div>
          <input
            type="file"
            id="fileBack"
            accept="image/*"
            onchange="handleFileUpload('back')"
          />

          <button
            class="btn btn-primary"
            id="btnStep2"
            onclick="nextStep()"
            disabled
          >
            Continue
          </button>
        </div>

        <!-- Step 3: Selfie -->
        <div class="step" id="step3">
          <h2 class="step-title">Step 3: Take a Selfie</h2>
          <p class="step-description">
            Please take a clear selfie for identity verification
          </p>

          <div class="camera-preview">
            <div class="upload-icon">ü§≥</div>
          </div>

          <div
            class="upload-area"
            id="uploadSelfie"
            onclick="document.getElementById('fileSelfie').click()"
          >
            <div class="upload-icon">üì∏</div>
            <div class="upload-text">Click to upload selfie</div>
          </div>
          <input
            type="file"
            id="fileSelfie"
            accept="image/*"
            onchange="handleFileUpload('selfie')"
          />

          <button
            class="btn btn-primary"
            id="btnStep3"
            onclick="nextStep()"
            disabled
          >
            Continue
          </button>
        </div>

        <!-- Step 4: Processing -->
        <div class="step" id="step4">
          <h2 class="step-title">Processing Verification</h2>
          <div class="loading">
            <div class="spinner"></div>
            <p class="step-description">
              Please wait while we verify your documents...
            </p>
          </div>
        </div>

        <!-- Step 5: Success -->
        <div class="step" id="step5">
          <div class="success-icon">‚úÖ</div>
          <h2 class="step-title">Verification Complete!</h2>
          <p class="step-description">
            Your identity has been successfully verified. Redirecting...
          </p>
        </div>

        <!-- Step 6: Error -->
        <div class="step" id="step6">
          <div class="error-icon">‚ùå</div>
          <h2 class="step-title">Verification Failed</h2>
          <p class="step-description">
            We couldn't verify your identity. Redirecting...
          </p>
        </div>
      </div>
    </div>

    <script>
      const workflowId = window.location.pathname.split("/").pop();
      let currentStep = 1;
      const uploads = {
        front: false,
        back: false,
        selfie: false,
      };

      function handleFileUpload(type) {
        const fileInput = document.getElementById(
          `file${type.charAt(0).toUpperCase() + type.slice(1)}`
        );
        const uploadArea = document.getElementById(
          `upload${type.charAt(0).toUpperCase() + type.slice(1)}`
        );
        const btn = document.getElementById(`btnStep${currentStep}`);

        if (fileInput.files.length > 0) {
          uploads[type] = true;
          uploadArea.classList.add("uploaded");
          uploadArea.querySelector(".upload-text").textContent =
            "‚úì Uploaded successfully";
          btn.disabled = false;
        }
      }

      function nextStep() {
        const currentStepEl = document.getElementById(`step${currentStep}`);
        currentStepEl.classList.remove("active");

        currentStep++;
        updateProgress();

        if (currentStep === 4) {
          // Processing step
          document.getElementById("step4").classList.add("active");
          submitWorkflow();
        } else if (currentStep <= 3) {
          document.getElementById(`step${currentStep}`).classList.add("active");
        }
      }

      function updateProgress() {
        const progress = (currentStep / 5) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      async function submitWorkflow() {
        try {
          const response = await fetch(`/workflow/${workflowId}/submit`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              uploads: uploads,
            }),
          });

          const result = await response.json();

          setTimeout(() => {
            document.getElementById("step4").classList.remove("active");

            if (result.status === "success") {
              document.getElementById("step5").classList.add("active");
              currentStep = 5;
              updateProgress();

              setTimeout(() => {
                if (result.successUrl) {
                  window.location.href = result.successUrl;
                }
              }, 2000);
            } else {
              document.getElementById("step6").classList.add("active");
              currentStep = 6;

              setTimeout(() => {
                if (result.errorUrl) {
                  window.location.href = result.errorUrl;
                }
              }, 2000);
            }
          }, 2000);
        } catch (error) {
          console.error("Error submitting workflow:", error);
          document.getElementById("step4").classList.remove("active");
          document.getElementById("step6").classList.add("active");
        }
      }

      // Initialize
      updateProgress();
    </script>
  </body>
</html>
